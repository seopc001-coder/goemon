<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>設定 | 五右衛門 管理画面</title>
    <link rel="stylesheet" href="./css/goemon-style.css?v=20251122005">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- ヘッダー -->
    <header class="admin-header">
        <div class="admin-header-left">
            <h1><i class="fas fa-cog"></i> 設定</h1>
        </div>
        <div class="admin-header-right">
            <span class="admin-user">
                <i class="fas fa-user-shield"></i>
                <span id="adminName">admin</span>
            </span>
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> ログアウト
            </button>
        </div>
    </header>

    <div class="admin-container">
        <!-- サイドバー -->
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <a href="goemon-admin.html" class="nav-item">
                    <i class="fas fa-arrow-left"></i>
                    <span>ダッシュボードに戻る</span>
                </a>
            </nav>
        </aside>

        <!-- メインコンテンツ -->
        <main class="admin-main">
            <!-- タブナビゲーション -->
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchTab('categories')">
                    <i class="fas fa-tags"></i> カテゴリ管理
                </button>
                <button class="settings-tab" onclick="switchTab('productTypes')">
                    <i class="fas fa-box"></i> 商品タイプ管理
                </button>
                <button class="settings-tab" onclick="switchTab('hero')">
                    <i class="fas fa-image"></i> ヒーロー画像設定
                </button>
                <button class="settings-tab" onclick="switchTab('system')">
                    <i class="fas fa-cogs"></i> システム設定
                </button>
            </div>

            <!-- カテゴリ管理タブ -->
            <div id="categoriesTab" class="settings-tab-content active">
                <div class="content-header">
                    <h2><i class="fas fa-tags"></i> カテゴリ管理</h2>
                    <button class="btn-cmn-01" onclick="openAddCategoryModal()">
                        <i class="fas fa-plus"></i> カテゴリを追加
                    </button>
                </div>

                <div class="categories-container">
                    <div class="info-box" style="margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i>
                        <p>カテゴリをドラッグ&ドロップして並び順を変更できます</p>
                    </div>

                    <div id="categoriesList" class="categories-list">
                        <!-- カテゴリリストがここに表示されます -->
                    </div>
                </div>
            </div>

            <!-- 商品タイプ管理タブ -->
            <div id="productTypesTab" class="settings-tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-box"></i> 商品タイプ管理</h2>
                    <button class="btn-cmn-01" onclick="openAddProductTypeModal()">
                        <i class="fas fa-plus"></i> 商品タイプを追加
                    </button>
                </div>

                <div class="product-types-container">
                    <div class="info-box" style="margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i>
                        <p>商品タイプをドラッグ&ドロップして並び順を変更できます</p>
                    </div>

                    <div id="productTypesList" class="categories-list">
                        <!-- 商品タイプリストがここに表示されます -->
                    </div>
                </div>
            </div>

            <!-- ヒーロー画像設定タブ -->
            <div id="heroTab" class="settings-tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-image"></i> ヒーロー画像設定</h2>
                    <button class="btn-cmn-01" onclick="openAddHeroImageModal()">
                        <i class="fas fa-plus"></i> 画像を追加
                    </button>
                </div>

                <div class="hero-images-container">
                    <div class="info-box" style="margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i>
                        <p>トップページのヒーロースライダーに表示される画像を管理します。ドラッグ&ドロップで並び順を変更できます。</p>
                    </div>

                    <div id="heroImagesList" class="hero-images-list">
                        <!-- ヒーロー画像リストがここに表示されます -->
                    </div>
                </div>
            </div>

            <!-- システム設定タブ -->
            <div id="systemTab" class="settings-tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-cogs"></i> システム設定</h2>
                </div>

                <div class="system-settings-container">
                    <div class="info-box" style="margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i>
                        <p>サイト全体のシステム設定を管理します。変更は即座に反映されます。</p>
                    </div>

                    <!-- ポイント設定 -->
                    <div class="settings-section" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                        <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-coins" style="color: #667eea;"></i>
                            ポイント設定
                        </h3>

                        <form id="pointSettingsForm">
                            <div class="form-group">
                                <label for="pointAwardRate">
                                    ポイント付与レート <span style="color: #f44336;">*</span>
                                </label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input
                                        type="number"
                                        id="pointAwardRate"
                                        class="form-control"
                                        min="1"
                                        max="10000"
                                        required
                                        style="max-width: 200px;"
                                    >
                                    <span style="color: #666;">円につき 1 ポイント</span>
                                </div>
                                <small style="color: #666; font-size: 12px; display: block; margin-top: 8px;">
                                    例: 500と入力すると、500円の購入ごとに1ポイント付与されます（現在の設定: <span id="currentPointRate">500</span>円 = 1pt）
                                </small>
                            </div>

                            <div class="modal-actions" style="margin-top: 30px;">
                                <button type="submit" class="btn-cmn-02">
                                    <i class="fas fa-save"></i> 保存
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- カテゴリ追加・編集モーダル -->
    <div id="categoryModal" class="modal-cmn">
        <div class="modal-cmn-container">
            <div class="modal-cmn-header">
                <h2 id="categoryModalTitle"><i class="fas fa-plus"></i> カテゴリを追加</h2>
                <button class="modal-cmn-close" onclick="closeCategoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-cmn-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">

                    <div class="form-group">
                        <label for="categoryName">
                            カテゴリ名 <span style="color: #f44336;">*</span>
                        </label>
                        <input
                            type="text"
                            id="categoryName"
                            class="form-control"
                            placeholder="例: メンズ、レディース、アクセサリー"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="categorySlug">
                            スラッグ（URL用） <span style="color: #f44336;">*</span>
                        </label>
                        <input
                            type="text"
                            id="categorySlug"
                            class="form-control"
                            placeholder="例: mens, ladies, accessories"
                            required
                        >
                        <small style="color: #666; font-size: 12px;">半角英数字とハイフンのみ使用可能</small>
                    </div>

                    <div class="form-group">
                        <label for="categoryDescription">説明</label>
                        <textarea
                            id="categoryDescription"
                            class="form-control"
                            rows="3"
                            placeholder="カテゴリの説明（任意）"
                        ></textarea>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cmn-03" onclick="closeCategoryModal()">
                            キャンセル
                        </button>
                        <button type="submit" class="btn-cmn-02">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ヒーロー画像追加・編集モーダル -->
    <div id="heroImageModal" class="modal-cmn">
        <div class="modal-cmn-container">
            <div class="modal-cmn-header">
                <h2 id="heroImageModalTitle"><i class="fas fa-plus"></i> ヒーロー画像を追加</h2>
                <button class="modal-cmn-close" onclick="closeHeroImageModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-cmn-body">
                <form id="heroImageForm">
                    <input type="hidden" id="heroImageId">

                    <div class="form-group">
                        <label for="heroImageUrl">
                            画像 <span style="color: #f44336;">*</span>
                        </label>
                        <div style="background: #f0f7ff; border: 1px solid #2196F3; border-radius: 4px; padding: 10px; margin-bottom: 10px;">
                            <i class="fas fa-info-circle" style="color: #2196F3; margin-right: 6px;"></i>
                            <strong style="color: #1976D2;">推奨画像サイズ:</strong>
                            <span style="color: #555;">1920×600px（横長） | 形式: JPG, PNG, WebP | 最大5MB</span>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <input
                                    type="file"
                                    id="heroImageFile"
                                    accept="image/jpeg,image/jpg,image/png,image/webp"
                                    class="form-control"
                                    style="margin-bottom: 8px;"
                                >
                                <input
                                    type="url"
                                    id="heroImageUrl"
                                    class="form-control"
                                    placeholder="画像URLまたは上記からファイルを選択"
                                    required
                                >
                            </div>
                            <div id="heroImagePreview" style="display: none; min-width: 100px;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="heroImageLink">リンク先URL</label>
                        <input
                            type="url"
                            id="heroImageLink"
                            class="form-control"
                            placeholder="https://example.com/page（任意）"
                        >
                        <small style="color: #666; font-size: 12px;">画像をクリックしたときの遷移先URL</small>
                    </div>

                    <div class="form-group">
                        <label for="heroImageAlt">
                            代替テキスト <span style="color: #f44336;">*</span>
                        </label>
                        <input
                            type="text"
                            id="heroImageAlt"
                            class="form-control"
                            placeholder="画像の説明"
                            required
                        >
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cmn-03" onclick="closeHeroImageModal()">
                            キャンセル
                        </button>
                        <button type="submit" class="btn-cmn-02">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 商品タイプ追加・編集モーダル -->
    <div id="productTypeModal" class="modal-cmn">
        <div class="modal-cmn-container">
            <div class="modal-cmn-header">
                <h2 id="productTypeModalTitle"><i class="fas fa-plus"></i> 商品タイプを追加</h2>
                <button class="modal-cmn-close" onclick="closeProductTypeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-cmn-body">
                <form id="productTypeForm">
                    <input type="hidden" id="productTypeId">

                    <div class="form-group">
                        <label for="productTypeName">
                            タイプ名 <span style="color: #f44336;">*</span>
                        </label>
                        <input
                            type="text"
                            id="productTypeName"
                            class="form-control"
                            placeholder="例: 新着アイテム、予約アイテム"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="productTypeSlug">
                            スラッグ（URL用） <span style="color: #f44336;">*</span>
                        </label>
                        <input
                            type="text"
                            id="productTypeSlug"
                            class="form-control"
                            placeholder="例: new-arrivals, pre-order"
                            required
                        >
                        <small style="color: #666; font-size: 12px;">半角英数字とハイフンのみ使用可能</small>
                    </div>

                    <div class="form-group">
                        <label for="productTypeDescription">説明</label>
                        <textarea
                            id="productTypeDescription"
                            class="form-control"
                            rows="3"
                            placeholder="商品タイプの説明（任意）"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="productTypeTag">
                            <i class="fas fa-tag"></i> タグ表示
                            <span style="color: #999; font-weight: normal; font-size: 12px;">（商品に表示されるタグ）</span>
                        </label>
                        <input
                            type="text"
                            id="productTypeTag"
                            class="form-control"
                            placeholder="例: NEW, SALE, 予約, 再入荷"
                            maxlength="10"
                        >
                        <small style="color: #666; font-size: 12px;">このタグが商品カードと商品詳細ページに表示されます（最大10文字）</small>
                    </div>

                    <div class="form-group">
                        <label for="productTypeTagColor">
                            <i class="fas fa-palette"></i> タグの色
                        </label>
                        <select id="productTypeTagColor" class="form-control">
                            <option value="blue">青（デフォルト）</option>
                            <option value="red">赤（セール向け）</option>
                            <option value="green">緑（新着向け）</option>
                            <option value="orange">オレンジ（予約向け）</option>
                            <option value="purple">紫（再入荷向け）</option>
                            <option value="gray">グレー</option>
                        </select>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cmn-03" onclick="closeProductTypeModal()">
                            キャンセル
                        </button>
                        <button type="submit" class="btn-cmn-02">
                            <i class="fas fa-save"></i> 保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- アラートモーダル -->
    <div id="alertModal" class="modal-cmn">
        <div class="modal-cmn-container modal-alert">
            <div class="modal-cmn-body">
                <div id="alertIcon" class="alert-icon"></div>
                <p id="alertMessage"></p>
                <button class="btn-cmn-01" onclick="closeAlertModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- 確認モーダル -->
    <div id="confirmModal" class="modal-cmn">
        <div class="modal-cmn-container modal-confirm">
            <div class="modal-cmn-body">
                <div class="confirm-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p id="confirmMessage"></p>
                <div class="modal-actions">
                    <button class="btn-cmn-03" onclick="closeConfirmModal()">キャンセル</button>
                    <button class="btn-cmn-02" id="confirmButton">確認</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./js/supabase-config.js?v=20251122003"></script>
    <script src="./js/goemon-public-db.js"></script>
    <script src="./js/goemon-admin-db.js?v=20251122171000"></script>
    <script src="./js/goemon-modal.js?v=20251122170000"></script>
    <script src="./js/goemon-admin-settings.js?v=20251125001"></script>
</body>
</html>
