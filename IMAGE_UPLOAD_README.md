# 画像アップロード機能 - 実装完了

## 実装内容

画像アップロード機能を実装しました。商品画像とヒーロー画像をファイルから直接アップロードできるようになりました。

## 追加・更新されたファイル

### 新規作成
1. **js/goemon-image-upload.js**
   - 画像アップロード機能の本体
   - Supabase Storage連携
   - Base64フォールバック機能
   - 画像バリデーション（形式・サイズチェック）
   - プレビュー表示機能

2. **SETUP_IMAGE_UPLOAD.md**
   - Supabaseセットアップガイド
   - 使用方法の詳細説明
   - トラブルシューティング

### 更新されたファイル
1. **goemon-admin-products.html**
   - 商品画像入力欄にファイルアップロード機能を追加
   - メイン画像 + サブ画像3枚（合計4枚）
   - プレビュー表示エリアを追加

2. **js/goemon-admin-products.js**
   - 画像アップロード初期化処理を追加
   - `initializeImageUploads()` 関数を追加

3. **goemon-admin-settings.html**
   - ヒーロー画像入力欄にファイルアップロード機能を追加
   - プレビュー表示エリアを追加

4. **js/goemon-admin-settings.js**
   - 画像アップロード初期化処理を追加
   - `initializeImageUploads()` 関数を追加

## 機能詳細

### 1. 商品画像アップロード
- **場所**: 商品管理画面（goemon-admin-products.html）
- **対応枚数**: メイン画像1枚 + サブ画像3枚（合計4枚）
- **使い方**:
  1. 商品追加/編集モーダルを開く
  2. 「ファイルを選択」ボタンをクリック
  3. 画像ファイルを選択
  4. 自動的にアップロードされ、URLが入力される
  5. プレビューが表示される

### 2. ヒーロー画像アップロード
- **場所**: 設定画面（goemon-admin-settings.html）の「ヒーロー画像設定」タブ
- **対応枚数**: 無制限（トップページスライダー用）
- **使い方**:
  1. 「画像を追加」をクリック
  2. 「ファイルを選択」ボタンをクリック
  3. 画像ファイルを選択
  4. 自動的にアップロードされ、URLが入力される
  5. プレビューが表示される

### 3. 両方に共通の機能
- **ファイル形式**: JPEG, PNG, WebP
- **ファイルサイズ**: 最大5MB
- **URL直接入力**: 従来通りURLの直接入力も可能
- **プレビュー**: 選択した画像を即座にプレビュー表示
- **バリデーション**: 不正なファイルは拒否され、エラーメッセージが表示される

## セットアップが必要

現在、画像は**Base64フォールバックモード**で動作します。
本番環境で使用する場合は、Supabase Storageのセットアップが必要です。

### セットアップ手順（5分程度）

1. **SETUP_IMAGE_UPLOAD.md** を開く
2. Supabaseアカウントを作成（無料プランでOK）
3. Storage Bucketを作成
4. `js/goemon-image-upload.js` に設定値を記入
5. 完了！

### セットアップ前の動作

Supabaseをセットアップしない場合：
- 画像はBase64形式でlocalStorageに保存される
- 開発・テスト用としては問題なく動作
- 本番環境では以下の制限があります：
  - データサイズが大きくなる
  - localStorageの容量制限（5-10MB）
  - 画像がローカルブラウザにのみ保存される

## テスト方法

### テスト1: 商品画像アップロード
1. `goemon-admin-products.html` を開く
2. 「商品を追加」をクリック
3. メイン画像の「ファイルを選択」から画像を選択
4. プレビューが表示されることを確認
5. URLフィールドに値が入力されることを確認

### テスト2: ヒーロー画像アップロード
1. `goemon-admin-settings.html` を開く
2. 「ヒーロー画像設定」タブをクリック
3. 「画像を追加」をクリック
4. 「ファイルを選択」から画像を選択
5. プレビューが表示されることを確認
6. URLフィールドに値が入力されることを確認

### テスト3: バリデーション
1. 5MBを超える画像を選択
2. エラーメッセージが表示されることを確認
3. 非対応形式（.gif, .bmpなど）を選択
4. エラーメッセージが表示されることを確認

## 技術仕様

### アップロードフロー
```
1. ユーザーがファイルを選択
   ↓
2. バリデーション（形式・サイズチェック）
   ↓
3. プレビュー表示
   ↓
4. Supabase Storage にアップロード
   （設定がない場合は Base64 変換）
   ↓
5. 取得したURLをフォームに入力
   ↓
6. 保存時に通常の商品/ヒーロー画像として保存
```

### ファイル構成
```
五右衛門ECサイト/
├── js/
│   ├── goemon-image-upload.js      (NEW) 画像アップロード機能
│   ├── goemon-admin-products.js    (更新) 商品管理
│   └── goemon-admin-settings.js    (更新) 設定管理
├── goemon-admin-products.html      (更新) 商品管理画面
├── goemon-admin-settings.html      (更新) 設定画面
├── SETUP_IMAGE_UPLOAD.md           (NEW) セットアップガイド
└── IMAGE_UPLOAD_README.md          (NEW) この説明書
```

## 今後の拡張可能性

1. **画像の自動リサイズ**
   - Supabase Functionsで実装可能
   - アップロード時に複数サイズを生成

2. **画像の一括アップロード**
   - ドラッグ&ドロップ対応
   - 複数ファイルの同時アップロード

3. **画像編集機能**
   - トリミング
   - フィルター適用
   - 明るさ・コントラスト調整

4. **画像管理画面**
   - アップロード済み画像の一覧表示
   - 画像の再利用
   - 不要な画像の削除

## 質問・サポート

ご質問やご不明な点がございましたら、お気軽にお問い合わせください。
